[gcode_macro _set_leds]
gcode:
    {% set red = params.RED|default(0)|float %}
    {% set green = params.GREEN|default(0)|float %}
    {% set blue = params.BLUE|default(0)|float %}
    {% set white = params.WHITE|default(0)|float %}
    {% set led = params.LED|string %}
    {% set idx = (params.IDX|string).split(',') %}
    {% set transmit_last = params.TRANSMIT|default(1) %}

    {% for led_index in idx %}
        {% set transmit=transmit_last if loop.last else 0 %}
        set_led led={led} red={red} green={green} blue={blue} white={white} index={led_index} transmit={transmit}
    {% endfor %}

[gcode_macro set_leds_by_name]
variable_colors: {
        'busy': {'r': 0.4, 'g': 0.0, 'b': 0.0, 'w': 0.0},
        'cleaning': {'r': 0.0, 'g': 0.02, 'b': 0.5, 'w': 0.0},
        'calibrating_z': {'r': 0.8, 'g': 0., 'b': 0.35, 'w': 0.0},
        'heating': {'r': 0.3, 'g': 0.18, 'b': 0.0, 'w': 0.0},
        'homing': {'r': 0.0, 'g': 0.6, 'b': 0.2, 'w': 0.0},
        'leveling': {'r': 0.5, 'g': 0.1, 'b': 0.4, 'w': 0.0},
        'meshing': {'r': 0.2, 'g': 1.0, 'b': 0.0, 'w': 0.0},
        'off': {'r': 0.0, 'g': 0.0, 'b': 0.0, 'w': 0.0},
        'printing': {'r': 1.0, 'g': 0.0, 'b': 0.0, 'w': 0.0},
        'ready': {'r': 0.25, 'g': 0.41, 'b': 0.88, 'w':0.0},
        'on': {'r': 0.8, 'g': 0.8, 'b': 0.8, 'w':1.0},
    }
variable_leds: {
        'logo': {'name': "sb_leds", 'idx': "1"},
        'nozzle': {'name': "sb_leds", 'idx': "2,3"},
        'knob': {'name': "btt_mini12864", 'idx': "1,2"},
        'screen': {'name': "btt_mini12864", 'idx': "3"},
    }
gcode:
    {% set color = colors[params.COLOR] %}
    {% set led = leds[params.LEDS] %}
    {% set transmit = params.TRANSMIT|default(1) %}

    _set_leds led={led.name} red={color.r} green={color.g} blue={color.b} white={color.w} idx="{led.idx}" transmit={transmit}